---
title: "311 Edit File"
author: "Ben Keel"
date: "2023-01-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning=FALSE)
knitr::opts_chunk$set(message=FALSE)

```

## Libraries & Set Up

```{r libraries & loading data, warning=FALSE, message=FALSE}

library(tidyverse)
library(kableExtra)
library(caret)
library(knitr) 
library(pscl)
library(plotROC)
library(pROC)
library(lubridate)
library(broom)
library(stargazer)
library(ggplot2)
library(gridExtra)
library(janitor)
library(sf)

library(boxr)

options(scipen=999)
options(tigris_class = "sf")
 
g<-glimpse

source("https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/functions.r")


crs <- "EPSG:4326"
PHL_crs <- 'ESRI:102411' #This measurement-based CRS projection is for the West Coast


```

## Loading Data

You can also embed plots, for example:

```{r loading box data, echo=FALSE}

#Box Upload Philadelphia Structure Fire
box_auth(client_id = "7olfapklfw3aflgpeb2kopxj1jceogg0", 
         client_secret = "xMUYd0SngtrtzGC92cZKon2jd6yyvM9d")

box_setwd(186732420366)

structureFire <- box_read_excel(1093000179542)

g(structureFire)

```

``` {r Structures Conversion}

structureFire_sf <- structureFire%>%
  drop_na(Longitude, Latitude)%>%
  st_as_sf(coords = c("Longitude", "Latitude"),
           crs = "EPSG:4326")

min(Property311$requested_datetime)

g(structureFire_sf)

```


```{r loading 311 data, echo=FALSE}

#311 Data Upload, downloaded from https://data.phila.gov/visualizations/311-requests/

All311 <- read_csv("D:/MUSA/MUSASpring/M8040_Practicum/Data/OpenDataPhilly-311Calls.csv")

g(All311)

```


``` {r 311 filter}

Property311 <- filter(All311, 
                        service_name == "Building Dangerous" |  
                        service_name == "Fire Safety Complaint" | 
                        service_name == "Maintenance Complaint" |
                        service_name == "Maintenance Residential or Commercial") %>%
  dplyr::select(objectid, service_request_id, status, service_name, service_code, requested_datetime, agency_responsible, address, zipcode, lat, lon)%>%
  drop_na(lat, lon)%>%
  st_as_sf(coords = c("lon", "lat"),
           crs = "EPSG:4326")

min(Property311$requested_datetime)


```